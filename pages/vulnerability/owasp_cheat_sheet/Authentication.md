概要
認証（AuthN）は、個人、エンティティ、またはウェブサイトが主張する内容が、その主張を裏付ける1つ以上の認証子（パスワード、指紋、またはセキュリティトークンなど）の妥当性を決定することによって、その個人、エンティティ、またはウェブサイトが誰であるか、または何であるかを検証するプロセスです。

デジタルアイデンティティは、オンライン取引に参加する主体のユニークな表現です。デジタルアイデンティティは、デジタルサービスのコンテキストで常にユニークですが、特定の現実世界の主体に追跡可能である必要はありません。

ID確認は、主体が実際に主張するものであることを確立します。このコンセプトはKYCコンセプトと関連しており、デジタルアイデンティティを実際の人物と結び付けることを目指しています。

セッション管理は、サーバーがそれとやり取りするエンティティの状態を維持するプロセスです。これは、トランザクション全体での後続のリクエストにどのように反応するかをサーバーが覚えておくために必要です。セッションは、クライアントとサーバー間でリクエストの送受信時にやり取りされるセッション識別子によってサーバー上で維持されます。セッションはユーザーごとに一意であり、計算上非常に予測困難である必要があります。セッション管理のチートシートには、このエリアのベストプラクティスに関するさらなるガイダンスが含まれています。

認証の一般的なガイドライン

ユーザーID
ユーザーIDの主な機能は、システム内でユーザーを一意に識別することです。理想的には、ユーザーIDはランダムに生成されるべきです。これにより、予測可能なまたは連続的なIDの作成が防止されます。これは、特にユーザーIDが外部ソースから公開されたり推測されたりする可能性があるシステムで、セキュリティリスクが発生する可能性があるためです。

ユーザー名
ユーザー名は、ユーザーが選択した、覚えやすい識別子であり、システムまたはサービスにログインする際に自分自身を識別するために使用されます。ユーザーが選択したユーザー名がシステム内でユニークな識別子として機能する場合、ユーザーIDとユーザー名の用語は同等に使用される場合があります。

ユーザーは、サインアップ時にメールアドレスをユーザー名として使用することが許可されるべきです。さらに、メールアドレス以外のユーザー名を選択するオプションを持つべきです。メールアドレスの検証に関する情報については、入力検証チートシートのメールディスカッションをご覧ください。

認証ソリューションと機密アカウント
センシティブなアカウント（つまり、バックエンド/ミドルウェア/DBなどのソリューション内で使用されるアカウント）でのフロントエンドユーザーインターフェースへのログインを許可しないでください
内部で使用されている認証ソリューション（たとえば、IDP / ADなど）をセキュリティ保護されていないアクセス（パブリックアクセス/ DMZなど）で使用しないでください
適切なパスワード強度制御の実装
パスワードを使用して認証する際の主な懸念事項は、パスワードの強度です。 「強い」パスワードポリシーは、手動または自動手段のいずれかでパスワードを推測することが難しく、または不可能にします。次の特性が強力なパスワードを定義します。

パスワードの長さ
アプリケーションによってパスワードの最小長さが強制されるべきです。 8文字未満のパスワードは弱いと見なされます（NIST SP800-63B）。
最大パスワード長はあまり低く設定しないでください。これにより、ユーザーがパスフレーズを作成するのを妨げる可能性があります。特定のハッシュアルゴリズムの制限により、一般的な最大長は64文字です。パスワードストレージチートシートで議論されているように、長いパスワードの拒否サービス攻撃を防ぐために最大パスワード長を設定することが重要です。
パスワードを静かに切り詰めないでください。パスワードストレージチートシートでは、最大長を超えるパスワードの処理方法に関するさらなるガイダンスが提供されます。
Unicodeや空白を含むすべての文字の使用を許可します。許可される文字のタイプを制限するパスワード構成ルールはありません。
パスワード漏洩が発生した場合、または妥協の特定時に資格情報を回転させてください。
パスワードの強度メーターを含めて、ユーザーがより複雑なパスワードを作成し、一般的な以前に侵害されたパスワードをブロックするためのライブラリであるzxcvbn-tsを使用できます。
Pwned Passwordsは、以前に侵害されたパスワードと照合できるサービスです。自分でホストするか、APIを使用できます。
詳細については次を参照してください¶
ASVS v4.0パスワードセキュリティ要件
パスワードの進化：現代の認証ガイダンス
安全なパスワード回復メカニズムの実装
アプリケーションには、ユーザーがパスワードを忘れた場合にアカウントにアクセスする手段を提供するメカニズムが一般的です。この機能の詳細については、「パスワードを忘れたときのチートシート」を参照してください。

安全な方法でパスワードを保存する
アプリケーションが正しい暗号技術を使用してパスワードを保存することは重要です。この機能の詳細については、「パスワードストレージチートシート」を参照してください。

安全な関数を使用してパスワードハッシュを比較する
可能な限り、ユーザーが提供したパスワードは、言語やフレームワークが提供する安全なパスワード比較関数を使用して保存されたパスワードハッシュと比較されるべきです。 PHPのpassword_verify（）関数のような。これが不可能な場合は、比較関数が次のようであることを確認してください。

非常に長い入力に対してサービス拒否攻撃を防ぐために、入力の最大長さを持っていること。
両変数の型を明示的に設定して、PHPのマジックハッシュなどの型混在攻撃に対する保護を確保します。
定数時間で戻ります。タイミング攻撃から保護するために、一定時間で戻るようにします。
パスワード変更機能
パスワード変更機能を開発する際には、次のことを確認してください。

ユーザーがアクティブなセッションで認証されています。
現在のパスワードの検証。これは、正当なユーザーがパスワードを変更していることを確認するためです。悪用ケースは次のとおりです。正当なユーザーがパブリックコンピューターを使用してログインしています。このユーザーがログアウトし忘れると、別の人がこのパブリックコンピューターを使用しています。現在のパスワードを検証しない場合、この他の人がパスワードを変更できる可能性があります。
パスワードはTLSまたはその他の強力なトランスポートのみを介して送信します
参照：トランスポートレイヤーセキュリティチートシート

ログインページおよびその後のすべての認証されたページは、TLSまたはその他の強力なトランスポートを介して独占的にアクセスされる必要があります。ログインページにTLSまたはその他の強力なトランスポートを使用しない場合、攻撃者はログインフォームのアクションを変更して、ユーザーの資格情報を任意の場所に投稿することができます。ログイン後の認証済みページにTLSまたはその他の強力なトランスポートを使用しない場合、攻撃者は暗号化されていないセッションIDを表示し、ユーザーの認証済みセッションを妨害することができます。

感度の高い機能に再認証を要求します
CSRFおよびセッションハイジャックを緩和するためには、ユーザーのパスワードやメールアドレスなどの感度の高いアカウント情報を更新する前に、アカウントの現在の資格情報を要求することが重要です。これを行わないと、攻撃者はユーザーの現在の資格情報を知る必要なしにCSRFまたはXSS攻撃を使用して感度の高いトランザクションを実行できる場合があります。さらに、攻撃者は一時的にユーザーのブラウザにアクセスしたり、セッションIDを盗んだりして、ユーザーのセッションを乗っ取ることができます。

強力なトランザクション認証を検討してください
一部のアプリケーションでは、ユーザーが感度の高い操作を実行できるかどうかをチェックするために、第二の要素を使用する必要があります。詳細については、トランザクション認証チートシートを参照してください。

TLSクライアント認証
TLSクライアント認証、または双方向TLS認証としても知られています。TLSハンドシェイクプロセス中に、ブラウザとサーバーの両方がそれぞれのTLS証明書を送信することで構成されます。サーバーの証明書を使用してサーバーの正当性を検証できるように、証明書が有効であるかどうかを検証可能な有効な証明機関（CA）に問い合わせることができます。サーバーは、クライアントから証明書を受け取り、サードパーティのCAまたは独自のCAと検証することによって、ユーザーを認証できます。これには、ユーザーに対して特別に生成された証明書を提供し、サブジェクトに値を割り当てて、証明書がどのユーザーを検証するかを決定するためにそれらを使用できるようにする必要があります。ユーザーは証明書をブラウザにインストールし、今後のウェブサイトで使用します。

これは以下の場合に行うのが良いアイデアです。

ユーザーがウェブサイトに単一のコンピューター/ブラウザからのみアクセスできる場合（または望ましい場合）。
ユーザーがブラウザにTLS証明書をインストールするプロセスに脅威を感じない場合、またはITサポートからユーザーが行う場合があります。
ウェブサイトが追加のセキュリティ手順を必要とする場合。
また、ウェブサイトが企業や組織のイントラネット向けのものである場合にも使用すると良いでしょう。
一般的に、Facebookのような広く一般に利用可能なウェブサイトに対してこの方法を使用するのは良いアイデアではありません。このテクニックはユーザーがパスワードを入力する必要がないため（平均的なキーロガーからの盗難を防ぐ）、パスワードとTLSクライアント認証を組み合わせて使用することを検討するのが良いアイデアとされています。

さらに、クライアントがSSL/TLS復号化を実行する企業プロキシの背後にある場合、これはサイトがプロキシで許可されている場合を除いて、証明書認証が壊れます。

詳細については、次を参照してください：クライアント認証TLSハンドシェイク

認証とエラーメッセージ
認証機能の場合に誤って実装されたエラーメッセージは、ユーザーIDとパスワードの列挙の目的に使用できます。アプリケーションは（HTTPとHTMLの両方で）一般的な方法で応答する必要があります。

認証応答
任意の認証メカニズム（ログイン、パスワードリセット、またはパスワードリカバリ）を使用する場合、次の手順を踏む必要があります。

失敗の詳細
失敗の詳細は、認証が失敗した理由に関する情報を提供します。これは、攻撃者が攻撃に成功した場合に攻撃に対処するための管理者に役立ちます。

アカウントロックアウト
アカウントロックアウトは、アカウントが一定の失敗した認証試行数を超えた場合に発生します。アカウントロックアウトは、アカウントの保護とセキュリティを向上させるために重要ですが、アカウントのロックアウトの回避方法は、一定数の失敗した認証試行のブルートフォース攻撃に利用される可能性があるため、適切に設定することが重要です。

アカウントロックアウトの詳細については、以下を参照してください。

OWASP：アカウントロックアウト
オートメーション
認証機能では、自動化された試行を防ぐことが重要です。これには、アカウントロックアウト、CAPTCHA、IPアドレス制限、2要素認証などの機能が含まれます。

暗号化されていない通信
センシティブなデータを送信する場合、すべての通信が適切に暗号化されていることを確認することが重要です。詳細については、「トランスポートレイヤーセキュリティチートシート」を参照してください。

ハードコードされた資格情報
ハードコードされた資格情報は、攻撃者がアプリケーションのソースコードまたはバイナリ内に資格情報を見つけることを可能にします。これらはアプリケーションの脆弱性を悪用する可能性があります。代わりに、認証情報を安全な場所に格納することを検討してください。 AWS Systems Managerパラメーターストア、Azure Key Vault、またはGCP Secret Managerなどのクラウドサービスを使用して、設定を保存し、アクセスできるようにすることができます。設定は、各環境（開発、ステージング、本番など）ごとに異なる可能性があるため、これらのサービスは環境変数を使用して設定を取得することができます。

認証のインフラストラクチャ
認証機能の実装では、アプリケーションのインフラストラクチャにも十分な注意が払われる必要があります。サーバー、データベース、およびその他の関連するシステムは、適切なセキュリティ態勢で設定され、定期的に監査される必要があります。さらに、アプリケーションのアップデート、パッチ、およびセキュリティ更新を維持するプロセスを確立することも重要です。
