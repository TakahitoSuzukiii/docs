取引認証チートシート

目的と対象者

このチートシートの目的は、取引認証を安全に実装し、バイパスされることから保護するためのガイドラインを提供することです。これらのガイドラインは以下のような方々に利用されます：

銀行 - 取引認証のための機能要件と非機能要件を定義するために。
開発者 - 脆弱性のない取引認証を設計および実装するために。
ペンテスター - 取引認証のセキュリティをテストするために。

はじめに

一部のアプリケーションでは、承認されたユーザーが機密操作を実行しているかどうかを確認するために、第二要素を使用します。一般的な例としては、オンラインやモバイルバンキングアプリケーションで使用される電信送金認証があります。

このドキュメントでは、このプロセスを取引認証と呼びます。

使用シナリオは金融システムに限定されません。たとえば、秘密のコードが含まれたメールや、ユーザーアカウントを解除するためのトークンが含まれたリンクなども、取引認証の特別なケースです。ユーザーは、第二の要素（電子メールアドレスに送信された一意のコード）を使用してアカウントの解除操作を承認します。取引認証はさまざまな方法で実装できます。例：

取引認証番号（TAN）を使用したカード
OATH TOTP（時間ベースのワンタイムパスワード）などの時間ベースのOTPトークン
SMSで送信されたOTPまたは電話で提供されたOTP
スマートカードやスマートフォンなどのデジタル署名
ユーザーのコンピュータースクリーンからトランザクションデータをスキャンする未接続のカードリーダーやソリューションなどのチャレンジ・レスポンス・トークン
これらのいくつかは物理的なデバイスまたはモバイルアプリケーションで実装できます。

取引認証は、マルウェア、フィッシング、パスワードやセッションハイジャック、CSRF、XSSなどの攻撃を利用した未承認の電信送金から保護するために実装されます。残念ながら、任意のコードと同様に、この保護は適切に実装されていない場合があり、その結果、この安全装置をバイパスすることが可能になる場合があります。

機能ガイドライン

取引認証方法は、ユーザーが重要な取引データを特定し、確認できるようにする必要があります
ユーザーのコンピューターはマルウェアの脅威のために信頼できません。したがって、ユーザーが外部デバイスで取引を特定できない方法は安全と見なされません。取引データは、外部の認証コンポーネントを使用して提示および確認する必要があります。

このような取引認証コンポーネントは、「見たまま署名するもの」という原則を使用して構築する必要があります。ユーザーが取引を承認する際には、彼らが何を承認しているかを知る必要があります。この原則に基づいて、認証方法は、特定の取引にとって重要なデータをユーザーが特定し、認識することを許可する必要があります。たとえば、電信送金の場合は、対象口座と金額です。

どの取引データを重要と見なすかに関する決定は、次のものに基づいて選択する必要があります。

実際のリスク
選択した認証方法の技術的な能力と制約
ポジティブなユーザーエクスペリエンス
例えば、SMSメッセージを使用して重要な取引データを送信する場合、対象口座、金額、および送金タイプを送信することができます。しかし、未接続のCAPリーダーの場合、ユーザーにこれらのデータを入力するのは不便だと感じられるかもしれません。そのような場合、最も重要な取引データ（例：部分的な対象口座番号と金額）のみを入力することが十分であると見なすことができます。

一般的に、重要な取引データは常に取引認証プロセスの本質的な部分として提示されるべきです。一方、ユ

ーザーエクスペリエンスは、ユーザーに取引データを確認するよう促すように設計される必要があります。

取引プロセスがユーザーに外部デバイスに取引データを入力するよう求める場合、ユーザーに特定の値（例：対象口座番号）の提供を求めるべきです。意味のあるプロンプトなしに値を入力することは、段落1.4の例で説明されているように、ソーシャルエンジニアリング手法を使用してマルウェアによって簡単に悪用される可能性があります。また、入力過多の問題の詳細な議論については、こちらを参照してください。

認証トークンの変更は、現在の認証トークンを使用して承認する必要があります
ユーザーがアプリケーションインターフェイスを使用して認証トークンを変更できる場合、その操作は現在の認証資格情報を使用して承認される必要があります（パスワード変更手順と同様です）。たとえば、ユーザーがSMSコードの電話番号を変更するときは、認証SMSコードを現在の電話番号に送信する必要があります。

認証方法の変更は、現在の認証方法を使用して承認される必要があります
一部のアプリケーションでは、ユーザーが複数の取引認証方法から選択できるようになっています。このような場合、ユーザーは現在の認証方法を使用して認証方法の変更を承認する必要があります。さもないと、マルウェアが認証方法を最も脆弱な方法に変更できます。

さらに、アプリケーションは、選択した認証方法に関連する潜在的な危険についてユーザーに通知する必要があります。

ユーザーは、認証プロセスと取引認証プロセスを簡単に区別できるようにする必要があります
アプリケーションが、認証と取引認証のためにユーザーに同じアクションを実行するよう要求すると、マルウェアが詐欺操作を承認させることがあります。次の例を考えてみてください：

アプリケーションがユーザー認証（通常は伝統的なログイン/パスワードの第二要素として）と取引認証のために同じ方法を使用しています。たとえば、OTPトークン、チャレンジ応答コード、外部スマートカードを使用した操作署名などが該当します。
マルウェアは、最初のステップ（アプリケーションへの認証）の後にユーザーに偽のエラーメッセージを表示し、ユーザーに認証手順を繰り返し実行させることができます。最初の認証コードは、マルウェアによって認証に使用され、2番目のコードは詐欺取引を承認するために使用されます。チャレンジ応答方式でも、このシナリオを使用して乱用される可能性があります。マルウェアが詐欺取引から取得したチャレンジを提示し、ユーザーに応答を提供するように誘導することができます。このような攻撃シナリオは、電子バンキングへのマルウェア攻撃で広く使用されています。

上記のシナリオでは、ユーザーの認証と取引認証のために同じ方法が使用されました。マルウェアは、この振る舞いを利用して、ユーザーの知識を得ることなく取引認証資格情報を抽出することができます。使用される認証および操作承認方法に関係なく、ソーシャルエンジニアリング手法が使用される可能性がありますが、アプリケーションはそのような攻撃シナリオを簡略化すべきではありません。

保護策は、ユーザーが認証と取引認証を簡単に区別できるようにする必要があります。これは、次の方法で達成できます。

認証と承認に異なる方法を使用する
または、外部セキュリティコンポーネントで異なるアクションを使用する（例：CAPリーダーでの異なる動作モード）
または、ユーザーに「署名する」内容について明確なメッセージを表示する
各取引は、一意の承認資格情報を

使用して承認される必要があります
一部のアプリケーションでは、一度だけ取引認証資格情報を要求し、その後、ユーザーがセッション全体で任意の取引を承認できるようになります。または、少なくとも、取引を承認するたびに同じ資格情報を再利用する必要があります。このような動作では、マルウェアがこれらの資格情報を嗅ぎ取り、ユーザーの知識を得ることなく任意の取引を承認することができますので、マルウェア攻撃を防ぐには十分ではありません。

非機能ガイドライン

認証はサーバーサイドで実行および強制される必要があります
他のすべてのセキュリティコントロールと同様に、取引認証はサーバーサイドで強制される必要があります。クライアントからサーバーに流れるデータを変更することで認証結果に影響を与えることは絶対に許されません。たとえば、次のようなことが該当します。

取引データを含むパラメーターを改ざんする
認証チェックを無効にするパラメーターを追加/削除する
エラーを発生させる
これを実現するには、セキュリティプログラミングのベストプラクティスを適用する必要があります。

デフォルトは拒否です。
プロダクションコードでのデバッグ機能の回避
改ざんを防ぐためには、追加の保護措置を検討する必要があります。たとえば、データの機密性と整合性を暗号化して保護し、サーバーサイドでデータを復号化および検証する際に注意を払うことが考えられます。

認証方法はサーバーサイドで強制される必要があります
ユーザーに複数の取引認証方法が提供されている場合、サーバーはユーザーがアプリケーションの設定で選択した現在の認証方法を使用するよう強制する必要があります。クライアントから提供されたパラメーターを操作して認証方法を変更することは不可能であるべきです。そうでないと、マルウェアが認証方法をより安全でない方法にダウングレードすることができます。

これは、アプリケーションが新しい、より安全な認証方法を追加するように開発された場合に特に重要です。新しい認証方法が古いコードベースの上に構築されることは珍しくありません。その結果、クライアントが古い方法を使用してパラメーターを送信する場合、ユーザーが既に新しい方法に切り替えていても、取引が承認される可能性があります。

取引検証データはサーバーサイドで生成される必要があります
重要な取引データがプログラムで認証コンポーネントに送信される場合、クライアントによる取引データの変更を拒否するために、追加の注意が必要です。ユーザーによって検証される重要な取引データは、サーバー上で生成および保存され、その後、クライアントによる改ざんの可能性なしに認証コンポーネントに渡される必要があります。

一般的な反パターンは、クライアント側で重要な取引データを収集し、サーバーに渡すことです。このような場合、マルウェアはこれらのデータを操作し、結果として、認証コンポーネントで偽の取引データを表示することができます。

アプリケーションは、認証資格情報のブルートフォース攻撃を防止する必要があります
取引認証資格情報がサーバーに検証される際、アプリケーションはブルートフォース攻撃を防止する必要があります。取引認証プロセスは、失敗した認証試行の数が一定数に達した後に再起動する必要があります。また、他のブルートフォース攻撃および自動化技術を防止するために、他の対策も検討される必要があります。OWASP認証チートシートを参照してください。

アプリケーションは、どの取引状態遷移が許可されているかを制御する必要があります
取引認証は通常、複数のステップで実

行されます。各ステップは、前のステップでの正当なアクションが完了した場合にのみ許可される必要があります。たとえば、ユーザーが検証されたデータを提供する前に、新しい取引を開始することはできません。また、すべての取引は終了後に正常に終了し、必要に応じてロールバックされる必要があります。これにより、マルウェアが未完了の取引を乱用して操作を実行することが防止されます。

例

デポジットアカウントに転送するための取引認証の例：

ユーザーがWebアプリケーションにログインする。
ユーザーが新しい転送取引を開始する。
アプリケーションは、転送先アカウント、金額、および目的を指定するようユーザーに求める。
ユーザーが取引を承認するために認証トークンを提供する。
アプリケーションは、取引を完了し、データベースに記録する。

攻撃と対策

認証トークンのスヌーピング
攻撃：攻撃者はユーザーが認証トークンを入力する際に、そのトークンを盗聴またはスヌープします。
対策：SSL / TLSなどのセキュアな通信プロトコルを使用して通信を暗号化します。また、認証トークンの送信には安全な手段（SMS、OTPジェネレーターなど）を使用します。

ソーシャルエンジニアリングによるユーザー誘導
攻撃：攻撃者はユーザーを誤解させ、偽の取引を承認させます。
対策：明確なメッセージを表示し、ユーザーが取引の内容を理解できるようにします。また、ユーザーに外部の情報源からのリンクをクリックしないよう警告することも重要です。

不正な取引の完了
攻撃：攻撃者は認証をバイパスして不正な取引を完了します。
対策：取引の完了前に追加の認証ステップを追加し、取引データの整合性を確認します。また、ブルートフォース攻撃を防止するための適切なロックアウトポリシーを実装します。

まとめ

取引認証は重要なセキュリティ機能であり、アプリケーションが金融取引や他の重要な操作を実行する際に保護を提供します。適切な実装と運用により、この機能はマルウェアや他の攻撃からユーザーを守ることができます。アプリケーションの開発者やセキュリティ専門家は、このガイドラインを参考にして、効果的な取引認証システムを構築および維持するためのベストプラクティスを実装することが重要です。