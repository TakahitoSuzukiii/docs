概要¶
認可は、「特定のエンティティに対して要求されたアクションやサービスが承認されていることを検証するプロセス」と定義されることがあります（NIST）。認可は、エンティティのアイデンティティを検証する認証プロセスとは異なります。ソフトウェアソリューションの設計と開発を行う際には、これらの区別を心に留めることが重要です。認証されたユーザー（たとえば、ユーザー名とパスワードを提供することによって）は、システムを介して技術的に可能なすべてのリソースにアクセスし、すべてのアクションを実行することができるとは限りません。たとえば、Webアプリケーションには通常のユーザーと管理者の両方がいる場合があり、管理者は認証されたものの、通常のユーザーには特権が与えられていないアクションを実行できることがあります。また、認証はリソースへのアクセスに常に必要とされるわけではありません。認証されていないユーザーでも、画像やログインページ、またはWebアプリケーション全体などの特定の公開リソースにアクセスすることが許可される場合があります。

このチートシートの目的は、堅牢で、アプリケーションのビジネスコンテキストに適した、保守可能でスケーラブルな認可ロジックの実装を開発者が支援することです。このチートシートで提供されるガイダンスは、開発ライフサイクルのすべての段階に適用されるはずであり、さまざまな開発環境のニーズを満たす柔軟性があります。

認可ロジックに関連する欠陥は、Webアプリケーションにとって顕著な懸念です。OWASPの2021年のトップ10では、破壊されたアクセス制御が最も懸念されるWebセキュリティの脆弱性としてランク付けされ、MITREのCWEプログラムによれば「高い」利用可能性での悪用が主張されています。さらに、VeracodeのState of Software Vol. 10によると、アクセス制御は、OWASPのトップ10リスクの中でも最も一般的ではないにもかかわらず、悪用やセキュリティインシデントに関与することが比較的多いです。

認可の欠陥の悪用による潜在的な影響は、形式や深刻さの両方で非常に変動があります。攻撃者は、保護されるはずのリソースを読み取ったり、作成したり、変更したり、削除したりすることができるかもしれません（その結果、機密性、整合性、および/または可用性が危険にさらされます）。ただし、そのような行動の実際の影響は、犠牲となるリソースの重要性と感度に必ずしもリンクしています。したがって、認可の欠陥が成功裏に悪用された場合のビジネスコストは、非常に低いものから非常に高いものまでさまざまです。

完全に認証されていない外部の者と（必ずしも認可されていないが）認証されたユーザーの両方が、認可の弱点を利用することができます。悪意のないエンティティの偶発的なミスや不注意により、認証のバイパスが可能になることがありますが、アクセス制御の脅威が完全に実現するには通常悪意が必要です。水平特権昇格（つまり、他のユーザーのリソースにアクセスできること）は、認証されたユーザーが利用できるかもしれない特に一般的な弱点です。認可制御に関連する不具合は、悪意のある内部者と外部者の両方が、すべての形式の機密リソース（データベースレコード、静的ファイル、個人を特定可能な情報（PII）など）を表示、変更、または削除することを可能にし、新しいアカウントを作成したり、コストのかかる注文を開始したりするようにすることができます。彼らに特権が与えられるべきではない。さらに、アクセス制御に関連するログ記録が適切に設定されていない場合、そのような認可の違反は検出されないか、少なくとも特定の個人やグループに帰属しないままになる可能性があります。

勧告¶
最小特権を強制する¶
セキュリティコンセプトとしての最小特権は、ユーザーに、その仕事を完了するのに必要な最小限の特権だけを割り当てる原則を指します。これは、おそらく最も一般的にはシステム管理で適用されますが、この原則はソフトウェア開発者にも関連します。最小特権は、水平方向と垂直方向の両方に適用する必要があります。たとえば、会計士と営業担当者が組織の階層で同じレベルにいる場合でも、それぞれが仕事を遂行するために異なるリソースにアクセスする必要があります。会計士にはおそらく顧客データベースへのアクセスが許可されず、営業担当者は給与データにアクセスできないはずです。同様に、営業部長は部下よりも特権のあるアクセスを必要とする可能性が高いでしょう。

アプリケーションで最小特権を強制しないと、機密リソースの機密性が危険にさらされる可能性があります。緩和策は主にアーキテクチャと設計段階で適用されます（CWE-272を参照）。ただし、この原則はSDLC全体で取り組む必要があります。

次の点とベストプラクティスを考慮してください：

設計段階では、信頼境界が定義されていることを確認します。システムにアクセスするユーザーのタイプ、公開されるリソース、およびそれらのリソースで実行できる操作（読み取り、書き込み、更新など）を列挙します。ユーザータイプとリソースのすべての組み合わせについて、ユーザーがそのリソースで実行できる操作を（役割やその他の属性に基づいて）決定します。ABACシステムの場合、すべての属性のカテゴリが考慮されていることを確認します。たとえば、営業担当者は、営業時間中の内部ネットワークから顧客データベースにアクセスする必要があるかもしれませんが、深夜に家からアクセスする必要はありません。
設計フェーズでマップアウトされたアクセス権を正しく強制していることを検証するテストを作成します。
アプリケーションがデプロイされた後は、現在の環境のユーザーの権限を定期的にレビューして、「特権の漏れ」を確認します。つまり、設計フェーズで定義された権限を超えないように、現在の環境のユーザーの特権を検証します（正式に承認された変更を加えることもできます）。
覚えておいてください。以前に享受していた特権を剥奪する必要がある場合に、ユーザーに追加の権限を与える方が簡単です。SDLCで最小特権を慎重に計画し実装することで、後で広範囲にわたって特権を取り消す必要が生じるリスクを軽減できます。
デフォルトで拒否する¶
明示的に一致するアクセス制御ルールがない場合でも、アプリケーションは特定のリソースへのアクセスを要求するエンティティが拒否されるか許可されるかを常に決定する必要があります。アクセス制御に関連するロジックエラーやその他のミスは発生する可能性があり、特にアクセス要件が複雑な場合には、明示的に定義されたルールに完全に依存しないでください。セキュリティ目的のために、アプリケーションはデフォルトでアクセスを拒否するように構成されている必要があります。

次の点とベストプラクティスを考慮してください：

アプリケーションの初期開発時や新しい機能やリソースが公開されるたびに、「デフォルトで拒否する」考え方を採用してください。特定のアクセス許可が特定のユーザーやグループに付与された理由を明示的に正当化できるはずです。アクセスがデフォルトの状態であると仮定するのではなく、特定のユーザーやグループにアクセスが許可される理由を明示的に説明できる必要があります。
一部のフレームワークやライブラリは自体がデフォルトで拒否する戦略を採用している場合がありますが、フレームワークやライブラリのデフォルトに依存する代わりに、明示的な構成を優先してください。サードパーティのコードのロジックとデフォルトは時間の経過とともに変化する可能性があります。プロジェクトに対する変更の影響を完全に把握することなく。
すべてのリクエストで権限を検証する¶
リクエストがAJAXスクリプト、サーバーサイド、またはその他のソースによって開始されたかに関係なく、すべてのリクエストで権限を正しく検証する必要があります。このようなチェックを実行するために使用されるテクノロジーは、個々のメソッドやクラスに個別に適用する必要はなく、グローバルでアプリケーション全体の構成が可能である必要があります。攻撃者は一つの入り口を見つければよいだけであり、単一のアクセス制御チェックが「見逃されても」、リソースの機密性や/または整合性が危険にさらされる可能性があります。リクエストの大部分でアクセス許可を正しく検証することは十分ではありません。開発者がこのような一貫したアクセス制御チェックを実行するのを支援する特定の技術には、次のものがあります。

Spring Securityを含むJava/Jakarta EEフィルターの実装
Djangoフレームワークのミドルウェア
.NET Coreフィルター
Laravel PHPフレームワークのミドルウェア
選択したツールと技術の認証ロジックを慎重に確認し、必要に応じてカスタムロジックを実装する¶
現代の開発者は、最小限の努力で堅牢で複雑なロジックをアプリケーションに組み込むことができる多くのライブラリ、プラットフォーム、およびフレームワークにアクセスできます。ただし、これらのフレームワークとライブラリは、すべての開発上の問題のための迅速な解決策と見なしてはなりません。開発者は、このようなフレームワークとライブラリを責任を持って賢く使用する義務があります。フレームワークやライブラリの選択に関連する一般的な懸念事項は、開発者の設定ミス/構成不足とコンポーネント自体の脆弱性です（これらのトピックに関する一般的なガイダンスについてはA6とA9を参照）。

それ以外は安全に開発されたアプリケーションでも、サードパーティのコンポーネントの脆弱性が通常の認証コントロールをバイパスすることができます。このような懸念事項は、未検証または適切にメンテナンスされていないプロジェクトに制限される必要はありませんが、最も堅牢で人気のあるライブラリやフレームワークにも影響します。複雑で安全なソフトウェアを作成することは難しいです。最も有能な開発者であっても、高品質のライブラリやフレームワークで作業する場合でも、ミスを犯すことがあります。アプリケーションに組み込まれたサードパーティのコンポーネントが認証の脆弱性の対象となる可能性があると見なすべきです。重要な考慮事項には次のものがあります。

脆弱なコンポーネントへの対応を検出し、対応するプロセスを作成および維持します。
Dependency CheckなどのツールをSDLCに組み込み、ベンダー、NVD、その他の関連するソースからのデータフィードの購読を検討します。これにより、使用しているライブラリが公知の脆弱性を含んでいないことを確認できます。
定期的なパッチ適用/アップデートを実装します。時間の経過とともに、新しい脆弱性が発見され、アップデートがリリースされる可能性があります。セキュリティが保護されたソフトウェアは、これらの問題に対処するプロセスを持っています。
依存関係の最小化を検討します。不要な依存関係は、潜在的なセキュリティリスクの温床となる可能性があります。
ベストプラクティスとして、サードパーティのコンポーネントのセキュリティが最新であることを確認するプロセスを持つことが重要です。セキュリティのリスクは常に変化しており、プロジェクトが進行している間に新たな脆弱性が発見される可能性があるためです。